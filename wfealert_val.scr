#============================================================
# IMPORTANT: Auto Generated Header. DO NOT CHANGE MANUALLY.
# Product: Finacle Core
# Category: User Defined
# Script: wfealert_val.scr
# Type: NA|default
# Description: These types of scripts do not belong to any particular category and are standalone scripts with no script specific repositories or fields.
# Author: AJIBADE
# Date: 3/11/15 6:06 PM
# Modification Log:
#============================================================

<--START
CHECKSUM="e204308b1327ec5dd0b979902a454f7488050c3bff933ef6153609ba938b34e3"
	# Script body goes here
	TRACE ON
	#**************************************************************************************
	#       MODIFIED BY             <Ajibade Cletus J>
	#       SECOND VER		        <10.2.16>
	#       DATE OF SECOND VER      <14-08-2014>
	#**************************************************************************************
	
	sv_a = urhk_B2k_PrintRepos("BANCS")
	
	#***************************************************
	# Now we create the Repository Classes to hold
	# the values for the form entered by the user
	#***************************************************
	IF (REPEXISTS("ALCUST") == 0) THEN
	#{
		CREATEREP("ALCUST")
	#}
	ENDIF
	IF (CLASSEXISTS("ALCUST","EALERT") == 0) THEN
	#{
		CREATECLASS("ALCUST", "EALERT", 5)
	#}
	ENDIF
	
	#####################################################################
	############## INPUTS FROM FRONT END(DETAILS PAGE) ##################
	#####################################################################
	#"A|V|M|D|U|I|C"
	ALCUST.EALERT.optionD = BANCS.INPUT.optionD
	PRINT(ALCUST.EALERT.optionD)
	ALCUST.EALERT.foracid = BANCS.INPUT.foracid
	PRINT(ALCUST.EALERT.foracid)
	ALCUST.EALERT.acctNameD = BANCS.INPUT.acctNameD
	PRINT(ALCUST.EALERT.acctNameD)
	ALCUST.EALERT.alertid= BANCS.INPUT.alertid
	PRINT(ALCUST.EALERT.alertid)
	ALCUST.EALERT.sms= BANCS.INPUT.sms
	PRINT(ALCUST.EALERT.sms)
	ALCUST.EALERT.smsaddr= BANCS.INPUT.smsaddr
	PRINT(ALCUST.EALERT.smsaddr)
	ALCUST.EALERT.email= BANCS.INPUT.email
	PRINT(ALCUST.EALERT.email)
	ALCUST.EALERT.emailaddr= BANCS.INPUT.emailaddr
	PRINT(ALCUST.EALERT.emailaddr)
	ALCUST.EALERT.delflg= BANCS.INPUT.delflg
	PRINT(ALCUST.EALERT.delflg)
	ALCUST.EALERT.drtran= BANCS.INPUT.drtran
	PRINT(ALCUST.EALERT.drtran)
	ALCUST.EALERT.crtran= BANCS.INPUT.crtran
	PRINT(ALCUST.EALERT.crtran)
	ALCUST.EALERT.chqdeposit= BANCS.INPUT.chqdeposit
	PRINT(ALCUST.EALERT.chqdeposit)
	ALCUST.EALERT.chqissuance= BANCS.INPUT.chqissuance
	PRINT(ALCUST.EALERT.chqissuance)
	ALCUST.EALERT.stopchq= BANCS.INPUT.stopchq
	PRINT(ALCUST.EALERT.stopchq)
	ALCUST.EALERT.returnchq= BANCS.INPUT.returnchq
	PRINT(ALCUST.EALERT.returnchq)
	ALCUST.EALERT.loandue= BANCS.INPUT.loandue
	PRINT(ALCUST.EALERT.loandue)
	ALCUST.EALERT.salaryinstr= BANCS.INPUT.salaryinstr
	PRINT(ALCUST.EALERT.salaryinstr)
	ALCUST.EALERT.standinginstr= BANCS.INPUT.standinginstr
	PRINT(ALCUST.EALERT.standinginstr)
	ALCUST.EALERT.maxamtflg= BANCS.INPUT.maxamtflg
	PRINT(ALCUST.EALERT.maxamtflg)
	ALCUST.EALERT.maxamt= BANCS.INPUT.maxamt
	PRINT(ALCUST.EALERT.maxamt)
	ALCUST.EALERT.minamtflg= BANCS.INPUT.minamtflg
	PRINT(ALCUST.EALERT.minamtflg)
	ALCUST.EALERT.minamt	= BANCS.INPUT.minamt
	PRINT(ALCUST.EALERT.minamt)
	ALCUST.EALERT.userid = BANCS.STDIN.userId
	PRINT(ALCUST.EALERT.userid)
	ALCUST.EALERT.principal = "P"
	PRINT(ALCUST.EALERT.principal)
	
	sv_y = ALCUST.EALERT.optionD
	PRINT(sv_y)
	sv_t = ALCUST.EALERT.userid
	PRINT(sv_t)
	
	ALCUST.EALERT.alertcode = ALCUST.EALERT.alertid
	
	PRINT(ALCUST.EALERT.foracid)
	PRINT(ALCUST.EALERT.alertcode)
	
	###################################################################
	###################### Validate Account Number ####################
	
	sv_v = "acctName|select acct_name from tbaadm.gam where foracid ='" + ALCUST.EALERT.foracid + "' "
	PRINT(sv_v)
	sv_u = urhk_dbSelectWithBind(sv_v)
	PRINT(sv_u)
	IF (sv_u ==0) THEN
	#{
		ALCUST.EALERT.acctName = BANCS.OUTPARAM.acctName
		PRINT(ALCUST.EALERT.acctName)
		#}
	ELSE
		#{
		sv_q = ALCUST.EALERT.foracid
		PRINT(sv_q)
		sv_v = "valacctno|select acct_num from custom.oldact where old_acct_num ='" + sv_q + "' "
		PRINT(sv_v)
		sv_u = urhk_dbSelectWithBind(sv_v)
		PRINT(sv_u)
		IF (sv_u ==0) THEN
		#{
			ALCUST.EALERT.foracid = BANCS.OUTPARAM.valacctno
			sv_q = "acctName|select acct_name from tbaadm.gam where foracid ='" + ALCUST.EALERT.foracid + "' "
			PRINT(sv_q)
			sv_u = urhk_dbSelectWithBind(sv_q)
			IF (sv_u == 0) THEN
			#{
				ALCUST.EALERT.acctName = BANCS.OUTPARAM.acctName
				PRINT(ALCUST.EALERT.acctName)
				#}
			ELSE
				#{
				sv_o = "Enter a correct Account number"
				sv_u = urhk_SetOrbOut("SuccessOrFailure|N")
				sv_u = urhk_SetOrbErr(sv_o)
				GOTO ENDOFSCRIPT
			#}
			ENDIF
			
			#}
		ELSE
			#{
			sv_o = "Enter a correct Account number"
			sv_u = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_u = urhk_SetOrbErr(sv_o)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
		#}
	#}
	ENDIF
	
	#############################################################################
	######################Check user work class and role id######################
	sv_q = "vwkc,rolid|select user_work_class,role_id from upr "
	sv_q = sv_q + "where user_id = '" + sv_t + "'"
	sv_q = sv_q + "AND del_flg != 'Y' "
	PRINT(sv_q)
	sv_r = urhk_dbSelectwithbind(sv_q)
	PRINT(sv_r)
	IF (sv_r != 0) THEN
	#{
		sv_o="user_work_class OR role_id error"
		sv_u = urhk_SetOrbOut("SuccessOrFailure|N")
		sv_u = urhk_SetOrbErr(sv_o)
		GOTO ENDOFSCRIPT
	#}
	ENDIF
	PRINT(BANCS.OUTPARAM.vwkc)
	sv_l = TRIM(BANCS.OUTPARAM.vwkc)
	
	IF((sv_y == "A")  OR (sv_y == "M"))   THEN
	#{
		sv_q = "phonenum|select phoneno from crmuser.phoneemail  "
		sv_q = sv_q + " where orgkey = (select cif_id from tbaadm.gam where foracid='" + ALCUST.EALERT.foracid + "')"
		sv_q = sv_q + "AND phoneoremail='PHONE'  AND preferredflag='Y' "
		PRINT(sv_q)
		sv_r = urhk_dbSelectwithbind(sv_q)
		PRINT(sv_r)
		IF (sv_r != 0) THEN
		#{
			sv_o="No PhoneNumber attached to this Account "
			sv_u = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_u = urhk_SetOrbErr(sv_o)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
		ALCUST.EALERT.phonenum = BANCS.OUTPARAM.phonenum
		PRINT(ALCUST.EALERT.phonenum)
		sv_z = STRLEN(ALCUST.EALERT.phonenum)
		PRINT(sv_z)
		ALCUST.EALERT.phonenum = MID$(ALCUST.EALERT.phonenum,7,sv_z)
		sv_f = STRLEN(ALCUST.EALERT.smsaddr)
		ALCUST.EALERT.smsaddrs  = MID$(ALCUST.EALERT.smsaddr,3,sv_f)
		PRINT(ALCUST.EALERT.smsaddrs)
		IF (ALCUST.EALERT.phonenum != ALCUST.EALERT.smsaddrs) THEN
		#{
			sv_o="Modify the Phone Number in CRM"
			sv_u = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_u = urhk_SetOrbErr(sv_o)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
	#}
	ENDIF
	
	IF(sv_y == "A")  THEN
	#{
		#IF(sv_l !="027") THEN
		IF(sv_l !="027") THEN
		#{
			sv_m = "You are not permitted to Add record"
			sv_v = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_v = urhk_SetOrbErr(sv_m)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
	#}
	ENDIF
	IF(sv_y == "V")  THEN
	#{
		#IF ((sv_l !="034") AND (sv_l !="032")) THEN
		IF ((sv_l !="034") AND (sv_l !="032")) THEN
		#{
			sv_m = "You are not permitted to authorise a subscription"
			sv_v = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_v = urhk_SetOrbErr(sv_m)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
	#}
	ENDIF
	IF(sv_y == "M")  THEN
	#{
		#IF(sv_l !="027") THEN
		IF(sv_l !="027") THEN
		#{
			sv_m = "You are not permitted to modify  record"
			sv_v = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_v = urhk_SetOrbErr(sv_m)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
		
		#sv_v = "alertid,string1|select alert_id,string1 from CUSTOM.ALERT_SUBSCRIPTION_TABLE where string1 ='" + RPAD(ALCUST.EALERT.foracid,64) + "' "
		#sv_v = sv_v + "AND alert_id ='" + RPAD(ALCUST.EALERT.alertcode,10) + "' "
		
		sv_v = "alertid,string1|select alert_id,string1 from CUSTOM.ALERT_SUBSCRIPTION_TABLE where string1 ='" + ALCUST.EALERT.foracid + "' "
		sv_v = sv_v + "AND alert_id ='" + ALCUST.EALERT.alertcode + "' "
		sv_v = sv_v + "AND  del_flg ='N'"
		PRINT(sv_v)
		sv_u = urhk_dbSelectWithBind(sv_v)
		PRINT(sv_u)
		IF (sv_u !=0) THEN
		#{
			sv_m = "Enter a correct alert code OR there is no authorised record"
			sv_l = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_a = urhk_SetOrbErr(sv_m)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
	#}
	ENDIF
	
	IF(sv_y == "D")  THEN
	#{
		#IF(sv_l !="034") THEN
		IF(sv_l !="034") THEN
		#{
			sv_m = "You are not permitted to delete a record"
			sv_v = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_v = urhk_SetOrbErr(sv_m)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
		
		#sv_v = "alertid,string1|select alert_id,string1 from CUSTOM.ALERT_SUBSCRIPTION_TABLE where string1 ='" + RPAD(ALCUST.EALERT.foracid,64) + "' "
		#sv_v = sv_v + "AND alert_id ='" + RPAD(ALCUST.EALERT.alertcode,10) + "' "
		sv_v = "alertid,string1|select alert_id,string1 from CUSTOM.ALERT_SUBSCRIPTION_TABLE where string1 ='" + ALCUST.EALERT.foracid + "' "
		sv_v = sv_v + "AND alert_id ='" + ALCUST.EALERT.alertcode + "' "
		sv_v = sv_v + "AND  del_flg ='N'"
		PRINT(sv_v)
		sv_u = urhk_dbSelectWithBind(sv_v)
		PRINT(sv_u)
		IF (sv_u !=0) THEN
		#{
			sv_m = "Enter a correct alert code OR there is no authorised record"
			sv_l = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_a = urhk_SetOrbErr(sv_m)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
	#}
	ENDIF
	IF(sv_y == "U")  THEN
	#{
		#IF(sv_l !="034") THEN
		IF(sv_l !="034") THEN
		#{
			sv_m = "You are not permitted to undelete a record"
			sv_v = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_v = urhk_SetOrbErr(sv_m)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
	#}
	ENDIF
	IF(sv_y == "I")  THEN
	#{
		#IF(sv_l !="027") THEN
		IF(sv_l !="027") THEN
		#{
			#			sv_m = "You are not permitted to Inquire"
			#			sv_v = urhk_SetOrbOut("SuccessOrFailure|N")
			#			sv_v = urhk_SetOrbErr(sv_m)
			#			GOTO ENDOFSCRIPT
		#}
		ENDIF
	#}
	ENDIF
	IF(sv_y == "C")  THEN
	#{
		#IF(sv_l !="027") THEN
		IF(sv_l !="027") THEN
		#{
			sv_m = "You are not permitted to change this record"
			sv_v = urhk_SetOrbOut("SuccessOrFailure|N")
			sv_v = urhk_SetOrbErr(sv_m)
			GOTO ENDOFSCRIPT
		#}
		ENDIF
	#}
	ENDIF
	
	ENDOFSCRIPT:
		DELETECLASS("ALCUST","EALERT")
		DELETEREP("ALCUST")
		
		EXITSCRIPT
		TRACE OFF
		
END-->
